<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cyber Toolbox</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Orbitron:wght@500&family=Share+Tech+Mono&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
  
  <style>
    /* ===== GLOBAL VARIABLES ===== */
    :root {
      --bg-color: #080012;
      --bg-rgb: 8,0,18;
      --accent: #ff0055;
      --accent-rgb: 255,0,85;
      --text: #f0f0f0;
      --glass: rgba(20,0,40,0.6);
      --neon: #00ffcc;
      --blood: #ff0040;
      --ink: #090b0b;
      --panel: #0b0f0f;
      --smoke: #0a0a0a;
      --glow: 0 0 10px var(--neon), 0 0 32px rgba(0,255,204,.6);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; overflow: hidden; }

    /* ===== LAYERED BACKGROUNDS ===== */
    /* Bottom layer: Nebula (from Occult) */
    #nebula {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -4;
    }

    /* Middle layer: Matrix rain (from Sandbox) */
    #matrix {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -3;
      background: var(--bg-color);
    }

    /* Top layer: Grid overlay (from Sandbox) */
    body::before {
      content: '';
      pointer-events: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 100% 2px;
      z-index: -2;
      mix-blend-mode: overlay;
    }

    /* CRT scanlines + chromatic aberration (from Occult) */
    body::after {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background: repeating-linear-gradient(0deg, rgba(255,255,255,.03) 0px, rgba(255,255,255,.03) 1px, transparent 2px, transparent 4px);
      mix-blend-mode: overlay;
      opacity: .14;
      z-index: -1;
    }

    /* ===== INTERFACE TOGGLE ===== */
    .interface-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }
    
    .toggle-btn {
      background: rgba(var(--accent-rgb), 0.2);
      border: 1px solid var(--accent);
      color: var(--text);
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-family: 'Roboto Mono', monospace;
      transition: all 0.3s;
    }
    
    .toggle-btn:hover {
      background: rgba(var(--accent-rgb), 0.4);
      box-shadow: 0 0 10px var(--accent);
    }

    /* ===== INTERFACE CONTAINERS ===== */
    .interface-container {
      display: none;
      height: 100vh;
      width: 100vw;
    }
    
    .interface-container.active {
      display: block;
    }

    /* ===== SANDBOX STYLES ===== */
    /* Header */
    .sandbox-header {
      position: relative;
      z-index: 10;
      text-align: center;
      padding: 2rem 1rem;
      background: rgba(var(--accent-rgb), 0.2);
      backdrop-filter: blur(4px);
      border-bottom: 1px solid rgba(var(--accent-rgb), 0.6);
      box-shadow: 0 2px 10px rgba(var(--accent-rgb), 0.4);
    }

    .sandbox-header h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 3rem;
      color: var(--accent);
      text-shadow: 0 0 10px rgba(var(--accent-rgb), 0.7);
      animation: glow 1.5s ease-in-out infinite alternate;
    }

    @keyframes glow {
      from { text-shadow: 0 0 5px rgba(var(--accent-rgb), 0.5); }
      to   { text-shadow: 0 0 20px rgba(var(--accent-rgb), 1); }
    }

    .sandbox-header p {
      margin-top: 0.5rem;
      font-size: 1.1rem;
      opacity: 0.8;
    }

    /* Main layout */
    .sandbox-main {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      padding: 1rem;
      height: calc(100vh - 130px);
    }

    /* Draggable panel */
    .sandbox-panel {
      position: relative;
      background: var(--glass);
      border: 1px solid rgba(var(--accent-rgb), 0.6);
      backdrop-filter: blur(6px);
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(var(--accent-rgb), 0.4);
      overflow: hidden;
      cursor: move;
      display: flex;
      flex-direction: column;
    }

    .sandbox-panel .titlebar {
      background: rgba(var(--accent-rgb), 0.8);
      padding: 0.5rem 1rem;
      font-weight: 700;
      font-size: 1rem;
      user-select: none;
    }

    .sandbox-panel .content {
      padding: 1rem;
      flex: 1;
      overflow-y: auto;
    }

    /* Terminal log */
    .terminal {
      background: rgba(0,0,0,0.8);
      color: #00ff00;
      padding: 1rem;
      font-size: 0.9rem;
      font-family: monospace;
      border-radius: 4px;
      box-shadow: inset 0 0 10px #00ff00;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .terminal .line {
      white-space: nowrap;
      overflow: hidden;
      width: 0;
      animation: type 2s steps(40) forwards;
    }

    .terminal .line.delay { animation-delay: 1s; }
    @keyframes type { to { width: 100%; } }

    /* Upload area */
    .upload-area {
      border: 2px dashed rgba(var(--accent-rgb), 0.6);
      padding: 2rem;
      text-align: center;
      color: rgba(var(--accent-rgb), 0.8);
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    .upload-area:hover {
      border-color: rgba(var(--accent-rgb), 1);
    }

    .upload-area input { display: none; }
    .upload-area label {
      cursor: pointer;
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background: var(--accent);
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(var(--accent-rgb), 0.5);
      transition: background 0.3s;
      display: inline-block;
    }

    .upload-area label:hover {
      background: rgba(var(--accent-rgb), 0.9);
    }

    /* Analysis panels */
    .report {
      font-family: monospace;
      background: rgba(0,0,0,0.85);
      border-radius: 4px;
      padding: 1rem;
      box-shadow: inset 0 0 15px var(--accent);
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .report .line {
      opacity: 0;
      animation: fadeIn 1s forwards;
    }

    .report .line:nth-child(1) { animation-delay: 0.5s; }
    .report .line:nth-child(2) { animation-delay: 1s; }
    .report .line:nth-child(3) { animation-delay: 1.5s; }
    .report .line:nth-child(4) { animation-delay: 2s; }

    /* ===== OCCULT STYLES ===== */
    /* Header */
    .occult-header {
      text-align: center;
      padding: 18px 12px 6px;
      position: relative;
      z-index: 2;
    }

    .occult-header h1 {
      margin: 0;
      font-size: clamp(34px, 6.4vw, 72px);
      text-shadow: 0 0 8px var(--blood), 0 0 24px var(--blood);
      animation: flicker 2.8s infinite;
      font-family: 'UnifrakturMaguntia', cursive;
      letter-spacing: 2px;
      color: #fff;
    }

    @keyframes flicker {
      0%, 100% { opacity: 1 }
      45% { opacity: .82 }
      50% { opacity: .6 }
      55% { opacity: .9 }
    }

    .subtitle {
      opacity: .9;
      filter: drop-shadow(0 0 4px var(--neon));
      margin-top: 4px;
    }

    /* Main layout */
    .occult-wrap {
      display: grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 16px;
      height: calc(100% - 128px);
      padding: 16px;
      position: relative;
      z-index: 2;
    }

    @media (max-width: 980px) {
      .occult-wrap { grid-template-columns: 1fr; height: auto; }
    }

    /* Panel */
    .occult-panel {
      background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.18));
      border: 1px solid rgba(0,255,204,.22);
      border-radius: 16px;
      padding: 14px;
      height: 100%;
      backdrop-filter: blur(2px);
      box-shadow: 0 0 22px rgba(0,255,204,.05), inset 0 0 22px rgba(0,255,204,.05);
    }

    /* Drop zone */
    #drop-zone {
      border: 2px dashed var(--neon);
      padding: 28px;
      min-height: 170px;
      text-align: center;
      transition: background .25s, transform .15s, box-shadow .2s;
      background: rgba(0,255,204,.03);
      box-shadow: inset 0 0 30px rgba(0,255,204,.06);
      border-radius: 16px;
      position: relative;
      overflow: hidden;
    }

    #drop-zone.dragover {
      background: rgba(0,255,204,.10);
      transform: scale(1.01);
      box-shadow: 0 0 22px rgba(0,255,204,.25) inset;
    }

    #drop-zone .hint { opacity: .85 }
    #file-input { display: none }

    /* Controls */
    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      margin: 10px 0 0;
    }

    .btn {
      cursor: pointer;
      border: 1px solid var(--neon);
      color: var(--neon);
      background: rgba(0,255,204,.08);
      padding: 10px 14px;
      border-radius: 999px;
      letter-spacing: .6px;
      box-shadow: var(--glow);
      transition: .15s transform, .15s box-shadow;
      user-select: none;
    }

    .btn:hover { transform: translateY(-2px) }
    .btn:active { transform: translateY(0) scale(.98) }
    .btn.ghost { background: transparent }
    .btn.alt { border-color: #7af; color: #bfe0ff; box-shadow: 0 0 10px #7af, 0 0 28px rgba(122,170,255,.6) }
    .btn.danger { border-color: var(--blood); color: var(--blood); box-shadow: 0 0 12px var(--blood), 0 0 24px var(--blood) }

    /* Log and progress */
    #progress, #log {
      height: 260px;
      overflow-y: auto;
      background: rgba(0,255,204,.035);
      border: 1px solid rgba(0,255,204,.2);
      border-radius: 12px;
      padding: 12px;
    }

    #log div {
      white-space: pre-wrap;
      margin: 6px 0;
      padding: 6px 8px;
      border-left: 3px solid rgba(0,255,204,.4);
      background: rgba(0,255,204,.05);
      border-radius: 6px;
    }

    .ok { color: #b8ffe9 }
    .fail { color: #ffb1c0; border-left-color: var(--blood); background: rgba(255,0,64,.05) }
    .info { color: #d2fff6 }

    /* Countdown */
    #countdown {
      font-size: 1.4em;
      text-align: center;
      color: var(--blood);
      margin-top: 10px;
      text-shadow: 0 0 8px var(--blood);
    }

    /* Meter */
    .meter {
      height: 10px;
      background: #061a16;
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid rgba(0,255,204,.25);
    }

    .bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--neon), #7affea);
      box-shadow: var(--glow);
      transition: width .2s ease;
    }

    /* FX elements */
    canvas.bg, canvas.fx, canvas.cursor {
      position: fixed;
      inset: 0;
      pointer-events: none;
    }

    .sigil {
      position: fixed;
      right: 20px;
      bottom: 20px;
      width: 120px;
      height: 120px;
      opacity: .25;
      filter: drop-shadow(0 0 6px var(--neon));
      animation: spin 16s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg) } }

    /* Glitch text */
    .glitch {
      position: relative;
      display: inline-block;
    }

    .glitch::before, .glitch::after {
      content: attr(data-text);
      position: absolute;
      left: 0;
      top: 0;
      opacity: .7;
    }

    .glitch::before { transform: translate(2px,0); color: #f0f; }
    .glitch::after { transform: translate(-2px,0); color: #0ff; }

    /* Ritual flash */
    .flash {
      position: fixed;
      inset: 0;
      background: white;
      opacity: 0;
      pointer-events: none;
      mix-blend-mode: screen;
      transition: opacity .2s;
    }

    .flash.on {
      opacity: .25;
      animation: flashfade .6s ease-out forwards;
    }

    @keyframes flashfade { to { opacity: 0 } }

    /* Footer */
    footer {
      text-align: center;
      opacity: .7;
      font-size: 12px;
      padding-bottom: 10px;
      position: relative;
      z-index: 2;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1200px) {
      .sandbox-main { grid-template-columns: 1fr 1fr; }
    }

    @media (max-width: 800px) {
      .sandbox-main { grid-template-columns: 1fr; }
      .occult-wrap { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <!-- BACKGROUND LAYERS -->
  <!-- Bottom: Nebula -->
  <canvas id="nebula" class="bg"></canvas>
  
  <!-- Middle: Matrix rain -->
  <canvas id="matrix"></canvas>
  
  <!-- Top: Shards and cursor trail -->
  <canvas id="shards" class="fx"></canvas>
  <canvas id="trail" class="cursor"></canvas>
  
  <!-- Flash effect -->
  <div id="flash" class="flash"></div>
  
  <!-- Sigil decoration -->
  <svg class="sigil" viewBox="0 0 100 100" aria-hidden="true">
    <circle cx="50" cy="50" r="46" fill="none" stroke="currentColor" stroke-width="2"/>
    <path d="M50 4 L50 96 M4 50 L96 50 M18 18 L82 82 M82 18 L18 82" stroke="currentColor" stroke-width="1"/>
    <circle cx="50" cy="20" r="4" fill="currentColor"/>
    <circle cx="80" cy="50" r="3" fill="currentColor"/>
    <circle cx="20" cy="50" r="3" fill="currentColor"/>
  </svg>

  <!-- INTERFACE TOGGLE BUTTON -->
  <div class="interface-toggle">
    <button id="toggleInterface" class="toggle-btn">Switch to Metadata Tool</button>
  </div>

  <!-- SANDBOX INTERFACE (DEFAULT VISIBLE) -->
  <div id="sandboxInterface" class="interface-container active">
    <header class="sandbox-header">
      <h1>Payload Sandbox</h1>
      <p>UI Demo ‚Ä¢ Safe ‚Ä¢ Simulated Malware Analysis</p>
    </header>

    <main class="sandbox-main">
      <!-- Environment -->
      <div class="sandbox-panel" id="env1">
        <div class="titlebar">Sandbox Environment</div>
        <div class="content">
          <div class="terminal">
            <div class="line">Booting virtual environment...</div>
            <div class="line delay">Isolating network interfaces...</div>
            <div class="line delay">Attaching virtual disk...</div>
            <div class="line delay">Environment ready.</div>
          </div>
        </div>
      </div>

      <!-- Upload & Logs -->
      <div class="sandbox-panel" id="env2">
        <div class="titlebar">Payload Loader & Logs</div>
        <div class="content">
          <div class="upload-area">
            <p>Drag & drop your payload here</p>
            <p>or</p>
            <label for="fileInput">Browse files</label>
            <input type="file" id="fileInput"/>
          </div>
          <div class="terminal" id="logTerminal" style="margin-top:1rem; flex:1;">
            <div class="line">Awaiting payload...</div>
          </div>
        </div>
      </div>

      <!-- Report -->
      <div class="sandbox-panel" id="env3">
        <div class="titlebar">Analysis Report</div>
        <div class="content report" id="analysisReport">
          <div class="line">No analysis run yet.</div>
          <div class="line">Threat Score: N/A</div>
          <div class="line">Detected Signatures: N/A</div>
          <div class="line">Recommendations: N/A</div>
        </div>
      </div>
    </main>
  </div>

  <!-- OCCULT INTERFACE (HIDDEN BY DEFAULT) -->
  <div id="occultInterface" class="interface-container">
    <header class="occult-header">
      <h1 class="glitch" data-text="Occult Metadata Eraser X">Occult Metadata Eraser X</h1>
      <div class="subtitle">summon ‚Ä¢ cleanse ‚Ä¢ zip ‚Ä¢ banish</div>
    </header>

    <div class="occult-wrap">
      <section class="occult-panel" aria-label="drop area">
        <div id="drop-zone">
          <div style="font-size:1.12em; margin-bottom:8px">Drop your <span class="glitch" data-text="cursed files">cursed files</span> here</div>
          <div class="hint">or <u id="browse">browse</u></div>
          <input id="file-input" type="file" multiple>
          <div class="controls" style="margin-top:12px">
            <button id="demo" class="btn">Load Dummy Files</button>
            <button id="panic" class="btn danger" title="Mute all audio">Silence Whispers</button>
            <button id="summon" class="btn alt" title="Start ritual with selected files">Begin Ritual</button>
            <button id="clearlog" class="btn ghost" title="Clear the log">Clear Log</button>
          </div>
          <div style="margin-top:12px">
            <div class="meter"><div id="meter" class="bar"></div></div>
            <div id="countdown"></div>
          </div>
        </div>

        <h3 style="margin:14px 4px 8px">üßÆ Progress Dashboard</h3>
        <div id="progress"></div>
      </section>

      <aside class="occult-panel" aria-label="ritual log">
        <h3 style="margin:0 0 8px 4px">üìú Ritual Log</h3>
        <div id="log"></div>
      </aside>
    </div>

    <footer>v3.0 ‚Äî Ultra Eldritch ‚Ä¢ Works offline ‚Ä¢ Nothing is uploaded ‚Ä¢ Shortcuts: <b>M</b>=mute, <b>D</b>=dummy, <b>Space</b>=begin</footer>
  </div>

  <!-- SCRIPTS -->
  <!-- Matrix Rain -->
  <script>
    (function(){
      const canvas = document.getElementById('matrix'),
            ctx = canvas.getContext('2d'),
            letters = '„Ç¢„Ç°„Ç´„Çµ„Çø„Éä„Éè„Éû„É§„É£„É©„ÉØ0123456789'.split('');
      let cols, drops;
      
      function resize(){
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        cols = Math.floor(canvas.width / 20);
        drops = Array(cols).fill(1);
      }
      
      window.addEventListener('resize', resize);
      resize();
      
      function draw(){
        ctx.fillStyle = 'rgba(0,0,0,0.05)';
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = `rgba(${getComputedStyle(document.body).getPropertyValue('--accent-rgb')},0.7)`;
        ctx.font = '16px monospace';
        drops.forEach((y,i)=> {
          const text = letters[Math.floor(Math.random()*letters.length)];
          ctx.fillText(text, i*20, y*20);
          if(y*20 > canvas.height && Math.random()>0.975) drops[i]=0;
          drops[i]++;
        });
      }
      
      setInterval(draw, 50);
    })();
  </script>

  <!-- Nebula Background -->
  <script>
    const neb = document.getElementById('nebula');
    const nctx = neb.getContext('2d');
    
    function sizeNebula() {
      neb.width = innerWidth;
      neb.height = innerHeight;
    }
    
    addEventListener('resize', sizeNebula);
    sizeNebula();
    
    let stars = Array.from({length:180}, () => ({
      x: Math.random()*neb.width,
      y: Math.random()*neb.height,
      r: Math.random()*1.7+0.3,
      s: Math.random()*0.6+0.25
    }));
    
    function drawNebula() {
      nctx.clearRect(0,0,neb.width,neb.height);
      
      const g = nctx.createRadialGradient(
        neb.width*0.5, neb.height*0.38, 40,
        neb.width*0.5, neb.height*0.38, Math.max(neb.width,neb.height)
      );
      
      g.addColorStop(0,'rgba(0,255,204,0.05)');
      g.addColorStop(1,'rgba(0,0,0,0)');
      nctx.fillStyle = g;
      nctx.fillRect(0,0,neb.width,neb.height);
      
      stars.forEach(st => {
        nctx.beginPath();
        nctx.arc(st.x,st.y,st.r,0,Math.PI*2);
        nctx.fillStyle = 'rgba(0,255,204,'+(0.55+Math.sin(performance.now()*0.002*st.s)*0.45)+')';
        nctx.fill();
      });
      
      requestAnimationFrame(drawNebula);
    }
    
    drawNebula();
  </script>

  <!-- Falling Shards -->
  <script>
    const shardsC = document.getElementById('shards');
    const sctx = shardsC.getContext('2d');
    
    function sizeShards() {
      shardsC.width = innerWidth;
      shardsC.height = innerHeight;
    }
    
    addEventListener('resize', sizeShards);
    sizeShards();
    
    let shards = [];
    
    function makeShard() {
      return {
        x: Math.random()*shardsC.width,
        y: -20,
        size: Math.random()*5+2,
        speed: Math.random()*2+1
      };
    }
    
    function animShards() {
      sctx.clearRect(0,0,shardsC.width,shardsC.height);
      shards.forEach(s => {
        sctx.fillStyle = '#00ffcc';
        sctx.fillRect(s.x,s.y,s.size,s.size);
        s.y += s.speed;
      });
      
      shards = shards.filter(s => s.y < shardsC.height);
      if(Math.random() < 0.33) shards.push(makeShard());
      requestAnimationFrame(animShards);
    }
    
    animShards();
  </script>

  <!-- Cursor Trail -->
  <script>
    const trail = document.getElementById('trail');
    const tctx = trail.getContext('2d');
    
    function sizeTrail() {
      trail.width = innerWidth;
      trail.height = innerHeight;
    }
    
    addEventListener('resize', sizeTrail);
    sizeTrail();
    
    let dots = [];
    
    addEventListener('mousemove', e => {
      dots.push({x:e.clientX, y:e.clientY, a:1});
      if(dots.length > 120) dots.shift();
    });
    
    (function animTrail() {
      tctx.clearRect(0,0,trail.width,trail.height);
      dots.forEach(d => {
        tctx.fillStyle = 'rgba(0,255,204,'+d.a+')';
        tctx.beginPath();
        tctx.arc(d.x,d.y,2,0,Math.PI*2);
        tctx.fill();
        d.a *= 0.94;
      });
      requestAnimationFrame(animTrail);
    })();
  </script>

  <!-- Interface Toggle -->
  <script>
    const toggleBtn = document.getElementById('toggleInterface');
    const sandboxInterface = document.getElementById('sandboxInterface');
    const occultInterface = document.getElementById('occultInterface');
    
    let currentInterface = 'sandbox';
    
    toggleBtn.addEventListener('click', () => {
      if(currentInterface === 'sandbox') {
        sandboxInterface.classList.remove('active');
        occultInterface.classList.add('active');
        toggleBtn.textContent = 'Switch to Sandbox';
        currentInterface = 'occult';
      } else {
        occultInterface.classList.remove('active');
        sandboxInterface.classList.add('active');
        toggleBtn.textContent = 'Switch to Metadata Tool';
        currentInterface = 'sandbox';
      }
    });
  </script>

  <!-- Draggable Panels -->
  <script>
    document.querySelectorAll('.sandbox-panel').forEach(panel => {
      let isDown = false, offsetX, offsetY;
      const title = panel.querySelector('.titlebar');
      
      title.addEventListener('mousedown', e => {
        isDown = true;
        offsetX = e.offsetX;
        offsetY = e.offsetY;
      });
      
      document.addEventListener('mousemove', e => {
        if(!isDown) return;
        panel.style.position = 'absolute';
        panel.style.left = (e.pageX - offsetX) + 'px';
        panel.style.top = (e.pageY - offsetY) + 'px';
      });
      
      document.addEventListener('mouseup', () => isDown = false);
    });
  </script>

  <!-- Dummy Malware Analysis -->
  <script>
    const logTerm = document.getElementById('logTerminal');
    const report = document.getElementById('analysisReport');
    
    document.getElementById('fileInput').addEventListener('change', runAnalysis);
    
    ['dragenter','dragover'].forEach(evt => {
      document.querySelector('.upload-area').addEventListener(evt, e => {
        e.preventDefault();
        e.stopPropagation();
      });
    });
    
    ['dragleave','drop'].forEach(evt => {
      document.querySelector('.upload-area').addEventListener(evt, e => {
        e.preventDefault();
        e.stopPropagation();
        if(evt === 'drop') runAnalysis(e);
      });
    });
    
    function runAnalysis(e) {
      const file = e.target.files ? e.target.files[0] : (e.dataTransfer && e.dataTransfer.files[0]);
      if(!file) return;
      
      logTerm.innerHTML = '';
      const lines = [
        `Loaded payload: ${file.name}`,
        'Scanning file headers...',
        'Extracting code segments...',
        'Emulating execution...',
        'Signature match found: Trojan.Generic',
      ];
      
      lines.forEach((txt, i) => {
        const div = document.createElement('div');
        div.className = 'line delay';
        div.style.animationDelay = `${0.5 + i*0.8}s`;
        div.textContent = txt;
        logTerm.append(div);
      });
      
      // Update report after all logs
      setTimeout(() => {
        report.innerHTML = '';
        const rpt = [
          `Analysis Complete: ${file.name}`,
          'Threat Score: 85/100',
          'Detected Signatures: Trojan.Generic',
          'Recommendations: Quarantine and remove payload.'
        ];
        
        rpt.forEach((txt, i) => {
          const d = document.createElement('div');
          d.className = 'line';
          d.textContent = txt;
          report.append(d);
        });
      }, lines.length * 800 + 500);
    }
  </script>

  <!-- Occult Metadata Eraser Functionality -->
  <script src="https://cdn.jsdelivr.net/npm/piexifjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip"></script>

  <script>
    // Elements
    const dropZone   = document.getElementById('drop-zone');
    const fileInput  = document.getElementById('file-input');
    const browseLink = document.getElementById('browse');
    const logEl      = document.getElementById('log');
    const progressEl = document.getElementById('progress');
    const countdown  = document.getElementById('countdown');
    const meter      = document.getElementById('meter');
    const demoBtn    = document.getElementById('demo');
    const panicBtn   = document.getElementById('panic');
    const summonBtn  = document.getElementById('summon');
    const clearBtn   = document.getElementById('clearlog');
    const flashEl    = document.getElementById('flash');

    // Audio
    const A = {
      whispers: new Audio('music.mp3'),
      glitch:   new Audio('https://freesound.org/data/previews/341/341695_3248244-lq.mp3'),
      gong:     new Audio('https://freesound.org/data/previews/146/146434_2615119-lq.mp3'),
      heart:    new Audio('https://freesound.org/data/previews/83/83456_1022651-lq.mp3'),
      ding:     new Audio('https://freesound.org/data/previews/337/337049_3232293-lq.mp3')
    };
    
    // Set loop for ambient sounds
    A.whispers.loop = true;
    A.heart.loop = true;
    
    let muted = false;
    
    function play(id) {
      if(muted) return;
      const el = A[id];
      try {
        el.currentTime = 0;
        el.play();
      } catch(e) {}
    }
    
    function stopAll() {
      Object.values(A).forEach(a => {
        try {
          a.pause();
          a.currentTime = 0;
        } catch(e) {}
      });
    }
    
    function toggleMute(force) {
      muted = (force !== undefined) ? !!force : !muted;
      if(muted) {
        stopAll();
      } else {
        try {
          A.whispers.volume = 0.5;
          A.whispers.play();
        } catch(e) {}
      }
      panicBtn.textContent = muted ? 'Whispers Silenced' : 'Silence Whispers';
    }

    // Utils
    function sleep(ms) { return new Promise(res => setTimeout(res, ms)) }
    
    function logLine(text, cls='info') {
      const el = document.createElement('div');
      el.textContent = text;
      el.className = cls;
      logEl.appendChild(el);
      logEl.scrollTop = logEl.scrollHeight;
    }
    
    function pct(n) {
      meter.style.width = Math.min(100, Math.max(0, n)) + '%';
    }
    
    const chants = [
      'The checksum must be appeased‚Ä¶',
      'Whispers detected in the EXIF lumen‚Ä¶',
      'Peel back the layers, reveal the void‚Ä¶',
      'Salt the bytes. Burn the sigils.',
      'Entropy rises. This is good.',
      'The archive accepts your offering.'
    ];
    
    function dummyFindings(file) {
      const seeds = ['GPS(13.37, 66.60)','Device:N0CT-Unit','Editor:Witchlight 6.66','‚àÜTime:+23s','CRC Veil:OK','Entropy:High','Phantom tag:TRUE','Checksum:‚àë√Ü','XMP Ghost: present','DPI Rune: 72'];
      const pick = () => seeds[Math.floor(Math.random()*seeds.length)];
      const lines = Array.from({length: 3+Math.floor(Math.random()*4)}, pick);
      return `‚Ä¢ Residuals: ${lines.join(' | ')}\n‚Ä¢ Cleanse Level: ${['Novice','Adept','Archmage','Elder'][Math.floor(Math.random()*4)]}`;
    }

    // Countdown
    function startCountdown(seconds, callback) {
      let t = seconds;
      countdown.textContent = `‚è≥ Ritual begins in ${t}s`;
      A.heart.volume = muted ? 0 : 0.3;
      try { A.heart.play(); } catch(e) {}
      
      const it = setInterval(() => {
        t--;
        countdown.textContent = `‚è≥ Ritual begins in ${t}s`;
        if(t <= 0) {
          clearInterval(it);
          countdown.textContent = 'üî• Ritual in progress...';
          callback();
        }
      }, 1000);
    }

    // Core cleanse
    async function eraseMetadata(files) {
      play('gong');
      flashEl.classList.add('on');
      setTimeout(() => flashEl.classList.remove('on'), 600);
      play('glitch');
      
      const zip = new JSZip();
      const report = [];
      let totalSize = 0;
      let types = {};
      let processed = 0;

      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const name = file.name;
        const ext = (name.split('.').pop() || '').toLowerCase();
        
        types[ext] = (types[ext] || 0) + 1;
        totalSize += file.size;
        pct((i/files.length)*100);

        logLine(`‚ñ∂ Inspecting ${name} (${(file.size/1024).toFixed(1)} KB)‚Ä¶`);
        if(Math.random() < 0.35) logLine('‚Ä¶ ' + chants[Math.floor(Math.random()*chants.length)], 'info');
        await sleep(220 + Math.random()*300);

        try {
          if(['jpg','jpeg'].includes(ext)) {
            const dataURL = await new Promise((resolve, reject) => {
              const r = new FileReader();
              r.onerror = () => reject('read fail');
              r.onload = () => resolve(r.result);
              r.readAsDataURL(file);
            });
            
            const stripped = piexif.remove(dataURL);
            zip.file(name, stripped.split(',')[1], { base64: true });
            
            report.push(`${name}: JPEG EXIF removed (Artist, Software, GPS, DateTime, XMP hints).\n${dummyFindings(file)}\n`);
            logLine(`‚úî ${name}: EXIF banished.`, 'ok');
          }
          else if(ext === 'png') {
            const blobURL = URL.createObjectURL(file);
            const img = await new Promise((res, rej) => {
              const im = new Image();
              im.onload = () => res(im);
              im.onerror = rej;
              im.src = blobURL;
            });
            
            const cnv = document.createElement('canvas');
            cnv.width = img.naturalWidth;
            cnv.height = img.naturalHeight;
            const c = cnv.getContext('2d');
            c.drawImage(img, 0, 0);
            
            const data = cnv.toDataURL('image/png');
            URL.revokeObjectURL(blobURL);
            
            const b64 = data.split(',')[1];
            zip.file(name, b64, {base64:true});
            
            report.push(`${name}: PNG re-encoded (tEXt/zTXt/iTXt stripped).\n${dummyFindings(file)}\n`);
            logLine(`‚úî ${name}: Ancillary runes erased.`, 'ok');
          }
          else if(ext === 'pdf') {
            const buffer = await file.arrayBuffer();
            const pdfDoc = await PDFLib.PDFDocument.load(buffer);
            
            pdfDoc.setTitle('');
            pdfDoc.setAuthor('');
            pdfDoc.setSubject('');
            pdfDoc.setCreator('');
            pdfDoc.setProducer('');
            pdfDoc.setKeywords([]);
            
            const out = await pdfDoc.save();
            zip.file(name, out);
            
            report.push(`${name}: PDF info dict cleared (Title/Author/Subject/Keywords/Creator/Producer).\n${dummyFindings(file)}\n`);
            logLine(`‚úî ${name}: Grimoire redacted.`, 'ok');
          }
          else if(['docx','pptx','xlsx'].includes(ext)) {
            const ab = await file.arrayBuffer();
            const cleansed = await cleanseOffice(ab);
            zip.file(name, cleansed);
            
            report.push(`${name}: Office container scrubbed (docProps removed).\n${dummyFindings(file)}\n`);
            logLine(`‚úî ${name}: Office sigils erased.`, 'ok');
          }
          else {
            const buf = await file.arrayBuffer();
            zip.file(name, buf);
            
            report.push(`${name}: Unknown format ‚Äî applied generic byte-salt cleanse and veil.\n${dummyFindings(file)}\n`);
            logLine(`‚Ä¢ ${name}: Generic purification applied.`, 'info');
          }
          
          processed++;
        } catch(err) {
          logLine(`‚úñ ${name}: resisted purification (${err}).`, 'fail');
        }
        
        await sleep(140 + Math.random()*220);
      }

      const rank = (processed < 3) ? 'Novice' : (processed < 6) ? 'Adept' : (processed < 10) ? 'Archmage' : 'Elder';
      progressEl.innerHTML = `‚úÖ Ritual complete<br>üßô Rank: ${rank}<br>üì¶ Total size: ${(totalSize/1024).toFixed(2)} KB<br>üìÅ Types: ${JSON.stringify(types)}`;
      pct(100);
      countdown.textContent = '‚úÖ Ritual complete';
      play('ding');
      A.heart.pause();

      const stamp = new Date().toISOString().replace(/[:.]/g,'-');
      const reportText = `OCCULT METADATA ERASER X ‚Äî RITUAL REPORT\nDate: ${new Date().toString()}\nRank: ${rank}\nFiles processed: ${processed}/${files.length}\n\nDETAILS\n------\n` + report.join('\n');
      zip.file(`ritual_report_${stamp}.txt`, reportText);

      const blob = await zip.generateAsync({type:'blob'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `cleansed_files_${stamp}.zip`;
      link.click();
    }

    // Handlers
    function begin(files) {
      if(!files || !files.length) {
        logLine('No offerings selected.', 'fail');
        return;
      }
      logLine(`‚Ñπ ${files.length} offerings placed upon the altar‚Ä¶`, 'info');
      startCountdown(3, () => eraseMetadata(files));
    }

    dropZone.addEventListener('dragover', e => {
      e.preventDefault();
      dropZone.classList.add('dragover');
    });
    
    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('dragover');
    });
    
    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.classList.remove('dragover');
      const files = Array.from(e.dataTransfer.files);
      begin(files);
    });

    document.getElementById('browse').addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', () => begin(Array.from(fileInput.files)));

    demoBtn.addEventListener('click', async () => {
      const demoFiles = [];
      
      // 1x1 JPEG
      const jpegData = atob('/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxAQEBUQFRUVFhUVFRUVFRUVFRUVFRUWFhUVFRUYHSggGB0lGxUVITEhJSkrLi4uFx8zODMtNygtLisBCgoKDg0OGxAQGy0lICUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLf/AABEIAAEAAgMBIgACEQEDEQH/xAAbAAACAwEBAQAAAAAAAAAAAAAEBQIDBgABB//EADoQAAIBAgQDBgUEAgMBAAAAAAECAAMRBBIhMQVBUWEGInGBEzKRobHB0RQjQlLh8BUjYnKi/8QAGQEAAwEBAQAAAAAAAAAAAAAAAQIDAAQB/8QAHhEBAAIDAQEBAQAAAAAAAAAAAAERAhIhAzETQRL/2gAMAwEAAhEDEQA/APf8s1v0nQhWKkqC3fUQ3WQ8r5Y1hR+v8reZxEPG6t8lyiep9M1+EMb+QPKC5KkOXVnEJlMNhfK0H989WCeJtVsNaeoRQC/B/6EH2o///Z');
      const jpegBlob = new Blob([new Uint8Array([...jpegData].map(c => c.charCodeAt(0)))], {type:'image/jpeg'});
      demoFiles.push(new File([jpegBlob], 'demo.jpg', {type:'image/jpeg'}));
      
      // 1x1 PNG
      const pngData = atob('iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==');
      const pngBlob = new Blob([new Uint8Array([...pngData].map(c => c.charCodeAt(0)))], {type:'image/png'});
      demoFiles.push(new File([pngBlob], 'sigil.png', {type:'image/png'}));
      
      // TXT
      demoFiles.push(new File([new TextEncoder().encode('be not afraid')], 'whisper.txt', {type:'text/plain'}));
      
      // Fake DOCX (tiny) from empty zip with minimal parts
      const z = new JSZip();
      z.file('[Content_Types].xml', '<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types"></Types>');
      const ab = await z.generateAsync({type:'arraybuffer'});
      demoFiles.push(new File([ab], 'husk.docx', {type:'application/vnd.openxmlformats-officedocument.wordprocessingml.document'}));
      
      begin(demoFiles);
    });

    panicBtn.addEventListener('click', () => toggleMute());
    clearBtn.addEventListener('click', () => {
      logEl.innerHTML = '';
      progressEl.innerHTML = '';
      pct(0);
      countdown.textContent = '';
    });
    
    summonBtn.addEventListener('click', () => begin(Array.from(fileInput.files || [])));

    // Global safety
    addEventListener('dragover', e => e.preventDefault());
    addEventListener('drop', e => {
      if(e.target === document.body) e.preventDefault();
    }, true);

    // Keyboard shortcuts
    addEventListener('keydown', e => {
      if(e.code === 'Space') {
        e.preventDefault();
        begin(Array.from(fileInput.files || []));
      }
      if(e.key === 'm' || e.key === 'M') {
        toggleMute();
      }
      if(e.key === 'd' || e.key === 'D') {
        demoBtn.click();
      }
    });

    // Start ambient
    try {
      A.whispers.volume = 0.5;
      A.whispers.play();
    } catch(e) {}
  </script>
</body>
</html>
